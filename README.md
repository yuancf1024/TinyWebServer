# TinyWebServer
🔥Linux C++ lightweight Web server, refer to @qinguoyi & Linux高性能服务器编程(游双).  



Linux下C++轻量级Web服务器.

- 使用 **线程池 + 非阻塞socket + epoll(ET和LT均实现) + 事件处理(Reactor和模拟Proactor均实现)** 的并发模型
- 使用**状态机**解析HTTP请求报文，支持解析**GET和POST**请求
- 访问服务器数据库实现web端用户**注册、登录**功能，可以请求服务器**图片和视频文件**
- 实现**同步/异步日志系统**，记录服务器运行状态
- 经Webbench压力测试可以实现**上万的并发连接**数据交换

## 改进及优化

TODO
- [x] 优化1
- [ ] 

## 日志

- [x] 2022-06-22 add 线程同步机制包装类


## 1-线程同步机制包装类

多线程同步，确保任一时刻只能有一个线程能进入关键代码段.

> - 信号量
> - 互斥锁
> - 条件变量

## 2-半同步/半反应堆线程池

使用一个工作队列完全解除了主线程和工作线程的耦合关系：主线程往工作队列中插入任务，工作线程通过竞争来取得任务并执行它。

> 模拟的Proactor事件处理模式:
> 具体的，主线程为异步线程，负责监听文件描述符，接收socket新连接，若当前监听的socket发生了读写事件，然后将任务插入到请求队列。工作线程从请求队列中取出任务，完成读写数据的处理。

> - 同步I/O模拟proactor模式
> - 半同步/半反应堆
> - 线程池

## 3-http连接处理类
> 根据状态转移,通过主从状态机封装了http连接类。其中,主状态机在**内部调用从状态机**,从状态机将**处理状态和数据**传给主状态机

> - 客户端发出http连接请求
> - 从状态机读取数据,更新自身状态和接收数据,传给主状态机
> - 主状态机根据从状态机状态,更新自身状态,决定**响应请求还是继续读取**


> 浏览器端发出http连接请求，主线程创建http对象接收请求并将所有数据读入对应buffer，将该对象插入任务队列，工作线程从任务队列中取出一个任务进行处理。
> 
## CGI & 数据库连接池

数据库连接池

> - 单例模式，保证唯一
> - list实现连接池
> - 连接池为静态大小
> - 互斥锁实现线程安全

CGI

> - HTTP请求采用POST方式
> - 登录用户名和密码校验
> - 用户注册及多线程注册安全

## 同步/异步日志系统

同步/异步日志系统主要涉及了两个模块，一个是日志模块，一个是阻塞队列模块,其中加入阻塞队列模块主要是**解决异步写入日志做准备**.

> - 自定义阻塞队列
> - 单例模式创建日志
> - 同步日志
> - 异步日志
> - 实现按天、超行分类

## 界面跳转

对html中action行为设置标志位，将method设置为POST

> - 0 注册
> - 1 登录
> - 2 登录检测
> - 3 注册检测
> - 5 请求图片
> - 6 请求视频
> - 7 关注我


## 定时器处理非活动连接

> 由于非活跃连接占用了连接资源，严重影响服务器的性能，通过实现一个服务器定时器，处理这种非活跃连接，释放连接资源。利用alarm函数周期性地触发SIGALRM信号,该信号的信号处理函数利用管道通知主循环执行定时器链表上的定时任务.

> - 统一事件源
> - 基于升序链表的定时器
> - 处理非活动连接

